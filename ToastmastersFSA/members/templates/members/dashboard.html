{% extends 'base_login.html' %}

{% load static %}
{% block title %} Tableau De Bord {% endblock %}

{% block head %}
<link rel="stylesheet"  href="{% static 'members/css/dashboard.css' %}?v=4">
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    window.dashboardData = {
        labels: {{ labels|safe }},
        dataPertinence: {{ data_pertinence|safe }},
        dataTemps: {{ data_temps|safe }},
        dataEloquence: {{ data_eloquence|safe }},
        dataStructure: {{ data_structure|safe }},
    };
</script>
<script type="text/javascript" src="{% static 'members/js/dashboard_chart.js' %}"></script>
<script type="text/javascript" src="{% static 'members/js/dashboard_animation.js' %}"></script>
{% endblock %}

{% block body %}
<div class="page-container">
<div class="layout-dashboard">
    <div class="column1-dashboard">
        {% include 'members/dashboard_profile.html' %}

        <div class="progression-section">
            <h2>Progression</h2>
            <div class="progression-container">
                {% for critere in progression %}
                <div class="progression-item">
                    <div class="progression-svg-wrapper">
                        <svg class="progress-ring" width="100" height="100" viewBox="0 0 100 100">
                            {% load l10n %}
                            <circle class="progress-ring__circle-bg"
                                    cx="50" cy="50" r="45"/>
                            <circle class="progress-ring__circle" 
                                cx="50" cy="50" r="45"
                                style="stroke-dasharray: {{ critere.circle_length|unlocalize }}; stroke-dashoffset: {{ critere.offset|unlocalize }}"/>
                        </svg>
                        <div class="progression-value">{{ critere.value }}%</div>
                    </div>
                    <div class="progression-label">{{ critere.label }}</div>
                </div>
                {% endfor %}
            </div>
        </div>
        

        <div class="evolution-section">
            <h2 style="margin-top:30px;">Évolution des critères</h2>
            <div class="progressionChart">
                <canvas id="progressionChart"></canvas>
            </div>
        </div>

        <div class="stats-section">
            <h2>Statistiques clés</h2>
            <div class="stats-row">
                <div class="stats-label">Séances assistées</div>
                <div class="stats-value">{{ stats.total_presences }} / {{ stats.total_meetings }}</div>
            </div>
            <hr class="stats-separator"/>
            <div class="stats-row">
                <div class="stats-label">Séances à venir</div>
                <div class="stats-value">{{ stats.next_meetings }}</div>
            </div>
            <hr class="stats-separator"/>
            <div class="stats-row">
                <div class="stats-label">Certificats obtenus</div>
                <div class="stats-value">{{ stats.certificats_won }}</div>
            </div>
            <hr class="stats-separator"/>
            <div class="stats-row">
                <div class="stats-label">Dernière participation</div>
                <div class="stats-value">{{ stats.last_meeting_attendance.meeting.date|date:"d M Y"|default:"-" }}</div>
            </div>
        </div>   
    </div>


    <div class="column2-dashboard">
        <div class="notifications-card">
            <div class="header-card">
                <h2>Notifications récentes</h2>
            </div>
            <div class="separator-line"></div>
            
            <ul class="notifications-list">
                {% for notif in notifications %}
                <li class="notification-item {% if not notif.is_read %}non-lue{% endif %}">
                    {{notif.title}}</br>
                    {{ notif.message| truncatechars:60 }}
                    <small class="notification-date">{{ notif.created_at|date:"d/m/Y H:i" }}</small>
                </li>
                {% empty %}
                <li>Aucune notification récente.</li>
                {% endfor %}
            </ul>
            {% if notifications %}
                <div class="notif-link-section">
                    <a href="#" class="notif-link">
                        Voir toutes les notifications
                    </a>
                </div>
            {% endif %}
        </div>

        {% include 'members/dashboard_seances.html' %}
    </div>

</div>
</div>
{% endblock %}
